# Data Map (DATAMAP.md)

This document provides a comprehensive map of the core data structures used throughout the Creator Cockpit application. It serves as a central reference for understanding the shape and purpose of our data, complementing the `APPMAP.md` and `SERVICEMAP.md`.

## Core Data Structures

### `GeminiFile`

Represents a file that has been registered with the Gemini API for use in the corpus. This is the central object for tracking and managing all user-provided files.

- **Definition (`types.ts`):**
  ```typescript
  export interface GeminiFile {
    name: string; // The unique resource name from the Gemini API (e.g., "files/12345").
    displayName: string; // The user-friendly name of the file.
    mimeType: string;
    sizeBytes: string;
    createTime: string;
    updateTime: string;
    uri: string; // The Gemini API URI for the file.
    state?: 'PROCESSING' | 'ACTIVE' | 'FAILED';
    status?: 'synced' | 'local_only' | 'api_only' | 'unknown'; // Application-specific status.
    isPermanent?: boolean; // Flag for core context documents.
    // ... other metadata
  }
  ```
- **Purpose:** To model file metadata from the Gemini API and enrich it with application-specific status and context.
- **Storage:** Stored in the `files` object store in IndexedDB.
- **Key Consumers:** `GeminiCorpusContext`, `FileManagementPanel`, `geminiFileService`.

---

### `ContextDocument`

Represents a core instructional or brand document used to provide context to the AI. These are foundational, long-lived documents.

- **Definition (`types.ts`):**
  ```typescript
  export interface ContextDocument {
    id: string; // A unique identifier, often derived from the filename.
    content: string; // The full markdown or text content.
    classification: string; // AI-generated classification (e.g., "Brand Voice", "Instructions").
    summary: string; // AI-generated summary.
    profile: string; // The tool profile this document is associated with (e.g., "global", "spa").
    isPermanent?: boolean; // Always true for these documents.
  }
  ```
- **Purpose:** To serve as the definitive, database-first source of truth for core AI context.
- **Storage:** Stored in the `permanent_documents` object store in IndexedDB. This is the new source of truth as of v1.9.0.
- **Key Consumers:** `ContentContext`, `geminiFileService`.

---

### `FileContentRecord`

Represents the raw binary content of a file, stored separately to optimize database performance.

- **Definition (`types.ts`):**
  ```typescript
  export interface FileContentRecord {
    internalName: string; // The internal identifier used to link to a `GeminiFile` record.
    content: Blob; // The actual file content as a Blob.
    mimeType: string;
    // ... other metadata
  }
  ```
- **Purpose:** To store the raw file content, allowing the main `files` table to remain lightweight.
- **Storage:** Stored in the `file_contents` object store in IndexedDB.
- **Key Consumers:** `geminiFileService`, `dbService` (for import/export).

---

### `Post`

Represents a single published article or newsletter, typically imported from an external source like a CSV.

- **Definition (`types.ts`):**
  ```typescript
  export interface Post {
    post_id: string;
    post_date: string;
    title: string;
    word_count: number;
    total_deliveries: number;
    total_opens: number;
    post_url: string;
    // ... other metadata
  }
  ```
- **Purpose:** To provide the core data for post analysis and insights.
- **Storage:** Stored in the `posts` object store in IndexedDB.
- **Key Consumers:** `DataContext`, `PostInsights` tool, `corpusProcessingService`.

---

### `GeneratedPost` / `ProcessedPost`

Represents a social media post generated by the AI in the Social Post Assistant tool.

- **Definition (`types.ts`):**
  ```typescript
  export interface GeneratedPost {
    id: string;
    quote: string | null;
    imageUrl: string | null;
    rawContent: string; // The direct output from the AI.
    isRegenerating: boolean;
    sources?: { uri: string; title: string }[];
  }

  export interface ProcessedPost extends GeneratedPost {
      content: string; // The `rawContent` after being processed for display (e.g., converting markdown to HTML).
  }
  ```
- **Purpose:** To manage the state and content of AI-generated social media drafts.
- **Storage:** This is a transient data structure held in the React state of the `SocialPostAssistant` component. It is **not** persisted in IndexedDB.
- **Key Consumers:** `SocialPostAssistant` and its sub-components.
